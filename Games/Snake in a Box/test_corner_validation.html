<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Corner Validation - Snake in a Box</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    .controls {
      text-align: center;
      margin: 20px 0;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: bold;
    }
    button:hover {
      background: #45a049;
    }
    .stats {
      background: white;
      padding: 20px;
      border-radius: 5px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stats h3 {
      margin-top: 0;
      color: #333;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .stat-label {
      font-weight: bold;
      color: #666;
    }
    .stat-value {
      color: #333;
    }
    .success {
      color: #4CAF50;
      font-weight: bold;
    }
    .error {
      color: #f44336;
      font-weight: bold;
    }
    .grids-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .grid-wrapper {
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .grid-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }
    .grid {
      display: grid;
      gap: 1px;
      background: #333;
      padding: 1px;
      border: 2px solid #333;
    }
    .tile {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      background: #fff;
    }
    .tile.corner {
      background: #fff3cd;
      border: 2px solid #ffc107;
    }
    .tile.head {
      background: #c8e6c9;
      color: #2e7d32;
    }
    .tile.tail {
      background: #ffcdd2;
      color: #c62828;
    }
    .tile.body {
      background: #e3f2fd;
      color: #1976d2;
    }
    .legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .legend-box {
      width: 30px;
      height: 30px;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üêç Corner Validation Test - Snake in a Box</h1>
  
  <div class="info">
    <strong>Test Purpose:</strong> Verify that corner tiles ALWAYS have corner/bend pieces (‚ó¢ ‚ó£ ‚ó§ ‚ó•), never straight pieces (‚îÅ ‚îÉ).
    <br><strong>Expected:</strong> All 4 corners should show corner symbols. Head (H) and Tail (T) should never be in corners.
  </div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-box" style="background: #fff3cd; border-color: #ffc107;">‚ó¢</div>
      <span>Corner Tile (must be bend piece)</span>
    </div>
    <div class="legend-item">
      <div class="legend-box" style="background: #c8e6c9; color: #2e7d32;">H</div>
      <span>Head (never in corner)</span>
    </div>
    <div class="legend-item">
      <div class="legend-box" style="background: #ffcdd2; color: #c62828;">T</div>
      <span>Tail (never in corner)</span>
    </div>
    <div class="legend-item">
      <div class="legend-box" style="background: #e3f2fd; color: #1976d2;">‚óè</div>
      <span>Body</span>
    </div>
  </div>

  <div class="controls">
    <button onclick="generateSingle()">Generate 1 Snake</button>
    <button onclick="generateMultiple(5)">Generate 5 Snakes</button>
    <button onclick="generateMultiple(10)">Generate 10 Snakes</button>
    <button onclick="clearResults()">Clear</button>
  </div>

  <div class="stats" id="stats" style="display: none;">
    <h3>üìä Validation Statistics</h3>
    <div class="stat-row">
      <span class="stat-label">Total Snakes Generated:</span>
      <span class="stat-value" id="total-count">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Valid Corner Pieces:</span>
      <span class="stat-value success" id="valid-corners">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Invalid Corner Pieces:</span>
      <span class="stat-value error" id="invalid-corners">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Head in Corner:</span>
      <span class="stat-value error" id="head-in-corner">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Tail in Corner:</span>
      <span class="stat-value error" id="tail-in-corner">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label">Success Rate:</span>
      <span class="stat-value" id="success-rate">0%</span>
    </div>
  </div>

  <div class="grids-container" id="grids"></div>

  <script>
    const GRID_SIZE = 5;
    let totalCount = 0;
    let validCorners = 0;
    let invalidCorners = 0;
    let headInCorner = 0;
    let tailInCorner = 0;

    // Symbol mapping for visualization
    const SYMBOLS = {
      'head-up': '‚ñ≤',
      'head-down': '‚ñº',
      'head-left': '‚óÑ',
      'head-right': '‚ñ∫',
      'tail-up': '‚ñ≥',
      'tail-down': '‚ñΩ',
      'tail-left': '‚óÅ',
      'tail-right': '‚ñ∑',
      'body-horizontal': '‚îÅ',
      'body-vertical': '‚îÉ',
      'corner-1': '‚ó¢', // left-top
      'corner-2': '‚ó£', // left-bottom
      'corner-3': '‚ó§', // right-bottom
      'corner-4': '‚ó•'  // right-top
    };

    function generateSingle() {
      generateMultiple(1);
    }

    function generateMultiple(count) {
      for (let i = 0; i < count; i++) {
        generateAndDisplaySnake();
      }
      updateStats();
    }

    function clearResults() {
      document.getElementById('grids').innerHTML = '';
      totalCount = 0;
      validCorners = 0;
      invalidCorners = 0;
      headInCorner = 0;
      tailInCorner = 0;
      document.getElementById('stats').style.display = 'none';
    }

    function generateAndDisplaySnake() {
      const path = generateSnakePath();
      const isValid = validateSnake(path);
      displaySnake(path, isValid);
      totalCount++;
    }

    function generateSnakePath() {
      // Simple zigzag pattern for testing
      const path = [];
      for (let row = 0; row < GRID_SIZE; row++) {
        if (row % 2 === 0) {
          for (let col = 0; col < GRID_SIZE; col++) {
            path.push({ row, col });
          }
        } else {
          for (let col = GRID_SIZE - 1; col >= 0; col--) {
            path.push({ row, col });
          }
        }
      }

      // Assign sprites
      for (let i = 0; i < path.length; i++) {
        const current = path[i];
        const prev = i > 0 ? path[i - 1] : null;
        const next = i < path.length - 1 ? path[i + 1] : null;

        if (i === 0) {
          current.type = 'head';
          current.sprite = getHeadSprite(current, next);
        } else if (i === path.length - 1) {
          current.type = 'tail';
          current.sprite = getTailSprite(current, prev);
        } else {
          current.type = 'body';
          current.sprite = getBodySprite(current, prev, next);
        }
      }

      return path;
    }

    function getSide(from, to) {
      if (!to) return 'none';
      if (to.row < from.row) return 'top';
      if (to.row > from.row) return 'bottom';
      if (to.col < from.col) return 'left';
      if (to.col > from.col) return 'right';
      return 'none';
    }

    function getHeadSprite(current, next) {
      const side = getSide(current, next);
      if (side === 'top') return 'head-down';
      if (side === 'bottom') return 'head-up';
      if (side === 'left') return 'head-right';
      if (side === 'right') return 'head-left';
      return 'head-right';
    }

    function getTailSprite(current, prev) {
      const side = getSide(current, prev);
      if (side === 'top') return 'tail-down';
      if (side === 'bottom') return 'tail-up';
      if (side === 'left') return 'tail-right';
      if (side === 'right') return 'tail-left';
      return 'tail-right';
    }

    function getBodySprite(current, prev, next) {
      const side1 = getSide(current, prev);
      const side2 = getSide(current, next);
      const sides = [side1, side2].sort().join('-');

      if (sides === 'bottom-top') return 'body-vertical';
      if (sides === 'left-right') return 'body-horizontal';
      if (sides === 'left-top') return 'corner-1';
      if (sides === 'bottom-left') return 'corner-2';
      if (sides === 'bottom-right') return 'corner-3';
      if (sides === 'right-top') return 'corner-4';
      return 'body-horizontal';
    }

    function isCornerPosition(row, col) {
      return (row === 0 || row === GRID_SIZE - 1) && 
             (col === 0 || col === GRID_SIZE - 1);
    }

    function validateSnake(path) {
      let valid = true;
      const corners = [
        { row: 0, col: 0 },
        { row: 0, col: GRID_SIZE - 1 },
        { row: GRID_SIZE - 1, col: 0 },
        { row: GRID_SIZE - 1, col: GRID_SIZE - 1 }
      ];

      // Check each corner
      for (const corner of corners) {
        const tile = path.find(t => t.row === corner.row && t.col === corner.col);
        if (!tile) continue;

        // Check if corner has straight piece (INVALID)
        if (tile.sprite === 'body-horizontal' || tile.sprite === 'body-vertical') {
          console.error(`Corner (${corner.row},${corner.col}) has STRAIGHT piece: ${tile.sprite}`);
          invalidCorners++;
          valid = false;
        } else if (tile.sprite.startsWith('corner-')) {
          // Valid corner piece
          validCorners++;
        }

        // Check if head or tail in corner
        if (tile.type === 'head') {
          headInCorner++;
          valid = false;
        }
        if (tile.type === 'tail') {
          tailInCorner++;
          valid = false;
        }
      }

      return valid;
    }

    function displaySnake(path, isValid) {
      const container = document.getElementById('grids');
      const wrapper = document.createElement('div');
      wrapper.className = 'grid-wrapper';

      const title = document.createElement('div');
      title.className = 'grid-title';
      title.textContent = isValid ? '‚úì Valid Snake' : '‚úó Invalid Snake';
      title.style.color = isValid ? '#4CAF50' : '#f44336';
      wrapper.appendChild(title);

      const grid = document.createElement('div');
      grid.className = 'grid';
      grid.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 40px)`;

      // Create grid
      for (let row = 0; row < GRID_SIZE; row++) {
        for (let col = 0; col < GRID_SIZE; col++) {
          const tile = path.find(t => t.row === row && t.col === col);
          const div = document.createElement('div');
          div.className = 'tile';

          if (isCornerPosition(row, col)) {
            div.classList.add('corner');
          }

          if (tile) {
            div.classList.add(tile.type);
            if (tile.type === 'head') {
              div.textContent = 'H';
            } else if (tile.type === 'tail') {
              div.textContent = 'T';
            } else {
              div.textContent = SYMBOLS[tile.sprite] || '‚óè';
            }
          }

          grid.appendChild(div);
        }
      }

      wrapper.appendChild(grid);
      container.appendChild(wrapper);
    }

    function updateStats() {
      document.getElementById('stats').style.display = 'block';
      document.getElementById('total-count').textContent = totalCount;
      document.getElementById('valid-corners').textContent = validCorners;
      document.getElementById('invalid-corners').textContent = invalidCorners;
      document.getElementById('head-in-corner').textContent = headInCorner;
      document.getElementById('tail-in-corner').textContent = tailInCorner;

      const successRate = totalCount > 0 
        ? ((totalCount - (invalidCorners / 4)) / totalCount * 100).toFixed(1)
        : 0;
      document.getElementById('success-rate').textContent = successRate + '%';
    }
  </script>
</body>
</html>